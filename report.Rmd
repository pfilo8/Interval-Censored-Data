---
title: "Report II"
subtitle: "Periodic inspections and interval censored data"
author: "Petronela Pawlisz (230032), Patryk Wielopolski (234891)"
output:
  pdf_document: default
  word_document: default
  html_document: default
  toc: True
  number_sections: True
header-includes:
- \usepackage{amsmath}
- \usepackage{float}
- \usepackage{listings}
- \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.align='center', message=F, warning=F) 
```

```{r echo=FALSE}
library(tidyverse)
library(ggplot2)
library(latex2exp)
library(patchwork)

source('src/generator.R')
source('src/plots.R')
```

\section{Introduction}
In this report we will focus on interval censored data. We will consider simple example of lightbulb which is periodicaly inspected if it has failed. 

\section{Generator}
Our implementation of generator is presented on Listing \ref{lst:generator}. Firsly we create counters for current time, last time of lightbulb checking and last time of lightbulb changing. Also we initialize vectors and list which will store our results. Implementation of event loop is a bit straightforward. We are going through while loop till the current time is smaller than simulation end time. Then we check if lightbulb failed. If yes, then we save intervals, change lightbulb to new one and generate its time of failure and save that time. After that we generate new inspection time. When the while loop ends, we add last observations, which wasn't censured. The function returns list of inspection times, light failure times, censored intervals and initial parameters.

\lstinputlisting[language=R, caption=Implementation of generator., label={lst:generator}, captionpos=b]{src/generator.R}

From theoretical aspect it's worth to mentions that process of inspections is a Poisson process because it starts in 0, its increases are independent and its waiting times for next event are independent and have exponential distribution. Besides process of lightbulb changes is not a Poisson process because waiting times are not idependet.

Sample realisations of process can be found on figure \ref{fig:sample}. There are two examples which shows times when inspection has occured (black dots) and lightbulb has died (red dots). As we can observe everything looks correct, especially failures and inspections are in correct order. But to be sure we will make further analysis in next section.

\begin{figure}
```{r echo=FALSE, fig.width=6, fig.height=4.5}
data1 <- generate_censored_data(1, 3, 30)

p1 <- realisation_of_the_process(data1) +
  ggtitle('Sample realistions of the process.') +
  xlim(0, 30)

data2 <- generate_censored_data(1, 3, 30)

p2 <- realisation_of_the_process(data2) +
  theme(axis.text.y = element_blank(),
        legend.position = 'bottom') +
  xlim(0, 30)

p1 / p2
```
\caption{Sample realisation of the process.}
\label{fig:sample}
\end{figure}


\section{Analysis of generator}

Before we start estimations of survival function we will take a closer look to our generator. To do that we have simulated 300 times our process for grid of parameters:
\begin{itemize}
  \item $\lambda$ - $[1, 10]$ with step equal 1,
  \item $\nu$ - $[1, 10]$ with step equal 1,
  \item $T_{0}$ - $[100, 700]$ with step equal 300.
\end{itemize}

We want to check following statistics:
\begin{itemize}
  \item number of lightbulb replacements,
  \item percentage of time without light,
  \item number of lightbulb inspections,
  \item number of lightbulb failures,
  \item percentage of time when one more inspections occured before failure.
\end{itemize}

Our results are presented on plots with following structure:
\begin{itemize}
  \item x-axis contains $\lambda$ - lightbulb failure rate,
  \item y-axis contains value of statistics,
  \item color represents $\nu$ - inspection rate,
  \item grid represents $T_{0}$ value.
\end{itemize}

```{r echo=FALSE}
dataframe_analysis <- read_csv('results/results_analysis_generator.csv')
```

Figure \ref{fig:replacements} represents number of lightbulb replacements. Our intuitions is that low rate of $\nu$ which corresponds to frequent checking of lightbulb will give us the highest value of lightbulb replacements. When we get higher value of this parameter, we will get smaller value of statistic. Also to our minds taking higher value of $\lambda$ will corresponds to smaller value of replacements because lightbulb will be more durable. As we can see on the plot all our intuisions are similar to obtained results. Also it's worth to mention that parameter $T_0$ only scales our plot but doesn't affect shape of curves.

\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = replacements, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('Number of lightbulb replacements.')) +
  ggtitle('Number of lightbulb replacements.') +
  theme_minimal()
```
\caption{Number of lightbulb replacements in setup of different parameters of process. Color represents value of $\nu$ - inspection rate.}
\label{fig:replacements}
\end{figure}

The second plot, which we will be analysing and can be found on Figure \ref{fig:without}, corresponds to statistic 'percentage of time without light'. It may be very crucial information from application perspective because from this plot we could deduce how often we should check our lightbulb to obtain specific level of percentage of time without light (and going beyond that this answears the question why we care about estimation methods of survival functions and parameter $\lambda$). Our intuintions for that plot is that for high value of $\lambda$ and small value of $\nu$ we will get the smallest value of statistic and conversely for small value of $\lambda$ and high value of $\nu$ we will get the highest value of statistic. First situation corresponds to very frequent checking of lightbuld which is durable and second one to very rare checking of not durable lightbulb. Our intuisions match to obtained results. Also parameter $T_0$ has no bigger influence to simulations.

\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = without, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('Percentage of time without light.')) +
  ggtitle('Percentage of time without light.') +
  theme_minimal()
```
\caption{Percentage of time without light in setup of different parameters of process. Color represents value of $\nu$ - inspection rate.}
\label{fig:without}
\end{figure}

The next plot represents number of lightublb inspections and can be found on figure \ref{fig:inspections}. Intuitions for that plot are quite straightforward. Inspections are Poisson process so we should obtain number of lightbulbs equal to $\frac{T_0}{\nu}$. Indeed our simulations confirms that and also it can be treated as empirical proof of previous fact. Also it's worth to mentation that these statistics doesn't depend on process of lightbulb failures.

\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = inspections, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('Number of lightbulb inspections.')) +
  ggtitle('Number of lightbulb inspections.') +
  theme_minimal()
```
\caption{Number of lightbulb inspections in setup of different parameters of process. Color represents value of $\nu$ - inspection rate.}
\label{fig:inspections}
\end{figure}


\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = failures, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Number of lightbulb failures.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:failures}
\end{figure}


\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = nonzero.left, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Non zero left intervals.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:non-zero}
\end{figure}

