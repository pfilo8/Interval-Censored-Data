---
title: "Report II"
subtitle: "Periodic inspections and interval censored data"
author: "Petronela Pawlisz (230032), Patryk Wielopolski (234891)"
output:
  pdf_document: default
  word_document: default
  html_document: default
  toc: True
  number_sections: True
header-includes:
- \usepackage{amsmath}
- \usepackage{float}
- \usepackage{listings}
- \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.align='center', message=F, warning=F) 
```

```{r echo=FALSE}
library(tidyverse)
library(ggplot2)
library(latex2exp)
library(patchwork)

source('src/generator.R')
```

\section{Introduction}
In this report we will focus on interval censored data. We will consider simple example of lightbulb which is periodicaly inspected if it has failed. 

\section{Generator}
Our implementation of generator is presented on Listing \ref{lst:generator}. Firsly we create counters for current time, last time of lightbulb checking and last time of lightbulb changing. Also we initialize vectors and list which will store our results. Implementation of event loop is a bit straightforward. We are going through while loop till the current time is smaller than simulation end time. Then we check if lightbulb failed. If yes, then we save intervals, change lightbulb to new one and generate its time of failure and save that time. After that we generate new inspection time. When the while loop ends, we add last observations, which wasn't censured.

\lstinputlisting[language=R, caption=Implementation of generator., label={lst:generator}, captionpos=b]{src/generator.R}

\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}

```
\caption{Caption.}
\label{fig:sample1}
\end{figure}



\begin{figure}
```{r echo=FALSE, fig.width=6, fig.height=4.5}
data1 <- generate_censored_data(1, 3, 30)

p1 <- ggplot(data.frame()) +
  geom_point(aes(x = data1$inspection_times, 
                 y = rep_len(0, length(data1$inspection_times)),
                 color = 'black')) +
  geom_point(aes(x = data1$light_failures_times, 
                 y = rep_len(0, length(data1$light_failures_times)), 
                 color = 'red')) +
  theme_minimal() +
  xlab(TeX('Time $t$')) +
  ylab('') +
  scale_color_manual(name = 'Type', 
                     values = c('black', 'red'), 
                     labels = c('Inspection', 'Lightbulb failed')) +
  theme(axis.text.y = element_blank(),
        legend.position = 'none')

data2 <- generate_censored_data(1, 3, 30)

p2 <- ggplot(data.frame()) +
  geom_point(aes(x = data2$inspection_times, 
                 y = rep_len(0, length(data2$inspection_times)),
                 color = 'black')) +
  geom_point(aes(x = data2$light_failures_times, 
                 y = rep_len(0, length(data2$light_failures_times)), 
                 color = 'red')) +
  theme_minimal() +
  xlab(TeX('Time $t$')) +
  ylab('') +
  scale_color_manual(name = 'Type', 
                     values = c('black', 'red'), 
                     labels = c('Inspection', 'Lightbulb failed'),
                     guide = 'legend') +
  theme(axis.text.y = element_blank(),
        legend.position = 'bottom')

p1 / p2
```
\caption{Caption.}
\label{fig:sample2}
\end{figure}


\section{Analysis of generator}

```{r echo=FALSE}
dataframe_analysis <- read_csv('results/results_analysis_generator.csv')
```

\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = replacements, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Number of lightbulb replacements.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:replacements}
\end{figure}


\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = without, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Percentage of time without light.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:without}
\end{figure}


\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = inspections, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Number of lightbulb inspections.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:inspections}
\end{figure}


\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = failures, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Number of lightbulb failures.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:failures}
\end{figure}


\begin{figure}
```{r echo=FALSE, fig.width=8, fig.height=4.5}
dataframe_analysis %>% 
  ggplot(aes(x = lambda, y = nonzero.left, group = nu, color = nu)) +
  geom_point() +
  geom_line() +
  facet_grid(~T0) +
  xlab(TeX('$\\lambda$ - lightbulb failure rate')) +
  ylab(TeX('$\\nu$ - inspection rate')) +
  ggtitle('Non zero left intervals.') +
  theme_minimal()
```
\caption{Caption.}
\label{fig:non-zero}
\end{figure}
